<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recuperar Senha - MedClinic</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@400;500&display=swap"
        rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': '#00C896',
                        'background-dark': '#0D1117',
                        'surface-dark': '#161B22',
                        'border-dark': '#30363D'
                    },
                    fontFamily: { display: ['Manrope', 'sans-serif'] }
                }
            }
        }
    </script>
    <style>
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400;
        }
    </style>
</head>

<body class="bg-background-dark text-white font-display min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-md">
        <!-- Logo -->
        <div class="text-center mb-8">
            <div class="inline-flex items-center justify-center w-16 h-16 bg-primary/10 rounded-2xl mb-4">
                <span class="material-symbols-outlined text-primary !text-4xl">local_hospital</span>
            </div>
            <h1 class="text-2xl font-bold">MedClinic</h1>
            <p class="text-slate-400">Recuperação de Senha</p>
        </div>

        <!-- Step 1: Email -->
        <div id="step-1" class="bg-surface-dark border border-border-dark rounded-xl p-6">
            <div class="mb-6">
                <span class="material-symbols-outlined text-primary !text-5xl block text-center mb-4">mail</span>
                <h2 class="text-lg font-semibold text-center mb-2">Esqueceu sua senha?</h2>
                <p class="text-sm text-slate-400 text-center">
                    Digite seu email cadastrado e enviaremos um código de verificação.
                </p>
            </div>

            <form id="email-form" onsubmit="sendCode(event)">
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Email</label>
                    <input type="email" id="email" required
                        class="w-full bg-background-dark border border-border-dark rounded-lg px-4 py-3 focus:border-primary focus:outline-none"
                        placeholder="seu@email.com">
                </div>

                <button type="submit"
                    class="w-full bg-primary text-background-dark py-3 rounded-xl font-semibold hover:brightness-110 transition-all">
                    Enviar Código
                </button>
            </form>

            <p class="text-center text-sm text-slate-400 mt-6">
                Lembrou a senha? <a href="login.html" class="text-primary hover:underline">Fazer login</a>
            </p>
        </div>

        <!-- Step 2: Code Verification -->
        <div id="step-2" class="bg-surface-dark border border-border-dark rounded-xl p-6 hidden">
            <div class="mb-6">
                <span class="material-symbols-outlined text-primary !text-5xl block text-center mb-4">pin</span>
                <h2 class="text-lg font-semibold text-center mb-2">Código de Verificação</h2>
                <p class="text-sm text-slate-400 text-center">
                    Digite o código de 6 dígitos enviado para<br>
                    <strong id="masked-email" class="text-white"></strong>
                </p>
            </div>

            <form id="code-form" onsubmit="verifyCode(event)">
                <div class="mb-4">
                    <div class="flex gap-2 justify-center" id="code-inputs">
                        <input type="text" maxlength="1"
                            class="code-input w-12 h-14 bg-background-dark border border-border-dark rounded-lg text-center text-2xl font-bold focus:border-primary focus:outline-none">
                        <input type="text" maxlength="1"
                            class="code-input w-12 h-14 bg-background-dark border border-border-dark rounded-lg text-center text-2xl font-bold focus:border-primary focus:outline-none">
                        <input type="text" maxlength="1"
                            class="code-input w-12 h-14 bg-background-dark border border-border-dark rounded-lg text-center text-2xl font-bold focus:border-primary focus:outline-none">
                        <input type="text" maxlength="1"
                            class="code-input w-12 h-14 bg-background-dark border border-border-dark rounded-lg text-center text-2xl font-bold focus:border-primary focus:outline-none">
                        <input type="text" maxlength="1"
                            class="code-input w-12 h-14 bg-background-dark border border-border-dark rounded-lg text-center text-2xl font-bold focus:border-primary focus:outline-none">
                        <input type="text" maxlength="1"
                            class="code-input w-12 h-14 bg-background-dark border border-border-dark rounded-lg text-center text-2xl font-bold focus:border-primary focus:outline-none">
                    </div>
                </div>

                <button type="submit"
                    class="w-full bg-primary text-background-dark py-3 rounded-xl font-semibold hover:brightness-110 transition-all">
                    Verificar Código
                </button>
            </form>

            <p class="text-center text-sm text-slate-400 mt-6">
                Não recebeu? <button onclick="resendCode()" class="text-primary hover:underline">Reenviar
                    código</button>
            </p>
        </div>

        <!-- Step 3: New Password -->
        <div id="step-3" class="bg-surface-dark border border-border-dark rounded-xl p-6 hidden">
            <div class="mb-6">
                <span class="material-symbols-outlined text-primary !text-5xl block text-center mb-4">lock_reset</span>
                <h2 class="text-lg font-semibold text-center mb-2">Nova Senha</h2>
                <p class="text-sm text-slate-400 text-center">
                    Crie uma nova senha segura para sua conta.
                </p>
            </div>

            <form id="password-form" onsubmit="resetPassword(event)">
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Nova Senha</label>
                    <div class="relative">
                        <input type="password" id="new-password" required
                            class="w-full bg-background-dark border border-border-dark rounded-lg px-4 py-3 pr-12 focus:border-primary focus:outline-none"
                            placeholder="Mínimo 8 caracteres">
                        <button type="button" onclick="togglePassword('new-password')"
                            class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-white">
                            <span class="material-symbols-outlined">visibility</span>
                        </button>
                    </div>
                    <div id="password-requirements" class="mt-2 text-xs space-y-1">
                        <p id="req-length" class="text-red-400">✗ Mínimo 8 caracteres</p>
                        <p id="req-upper" class="text-red-400">✗ Uma letra maiúscula</p>
                        <p id="req-lower" class="text-red-400">✗ Uma letra minúscula</p>
                        <p id="req-number" class="text-red-400">✗ Um número</p>
                    </div>
                </div>

                <div class="mb-6">
                    <label class="block text-sm font-medium mb-2">Confirmar Senha</label>
                    <input type="password" id="confirm-password" required
                        class="w-full bg-background-dark border border-border-dark rounded-lg px-4 py-3 focus:border-primary focus:outline-none"
                        placeholder="Digite novamente">
                    <p id="match-error" class="text-red-400 text-xs mt-1 hidden">As senhas não coincidem</p>
                </div>

                <button type="submit" id="submit-btn" disabled
                    class="w-full bg-primary text-background-dark py-3 rounded-xl font-semibold hover:brightness-110 transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                    Redefinir Senha
                </button>
            </form>
        </div>

        <!-- Step 4: Success -->
        <div id="step-4" class="bg-surface-dark border border-border-dark rounded-xl p-6 hidden text-center">
            <div class="w-20 h-20 bg-emerald-500/10 rounded-full flex items-center justify-center mx-auto mb-6">
                <span class="material-symbols-outlined text-emerald-500 !text-5xl">check_circle</span>
            </div>
            <h2 class="text-xl font-bold mb-2">Senha Alterada!</h2>
            <p class="text-slate-400 mb-6">
                Sua senha foi redefinida com sucesso. Você já pode fazer login com a nova senha.
            </p>
            <a href="login.html"
                class="block w-full bg-primary text-background-dark py-3 rounded-xl font-semibold hover:brightness-110 transition-all text-center">
                Ir para Login
            </a>
        </div>
    </div>

    <script src="../js/utils/validation.js"></script>
    <script src="../js/utils/utils.js"></script>
    <script>
        let userEmail = '';
        const mockCode = '123456'; // In production, this would be sent via email

        // Code input auto-focus
        document.querySelectorAll('.code-input').forEach((input, index, inputs) => {
            input.addEventListener('input', (e) => {
                if (e.target.value && index < inputs.length - 1) {
                    inputs[index + 1].focus();
                }
            });
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Backspace' && !e.target.value && index > 0) {
                    inputs[index - 1].focus();
                }
            });
        });

        // Password validation live update
        document.getElementById('new-password')?.addEventListener('input', (e) => {
            const password = e.target.value;

            updateRequirement('req-length', password.length >= 8);
            updateRequirement('req-upper', /[A-Z]/.test(password));
            updateRequirement('req-lower', /[a-z]/.test(password));
            updateRequirement('req-number', /\d/.test(password));

            checkPasswordMatch();
        });

        document.getElementById('confirm-password')?.addEventListener('input', checkPasswordMatch);

        function updateRequirement(id, valid) {
            const el = document.getElementById(id);
            el.className = valid ? 'text-emerald-400' : 'text-red-400';
            el.textContent = (valid ? '✓ ' : '✗ ') + el.textContent.substring(2);
        }

        function checkPasswordMatch() {
            const password = document.getElementById('new-password').value;
            const confirm = document.getElementById('confirm-password').value;
            const validation = Validation.isValidPassword(password);

            const match = password === confirm && confirm.length > 0;
            document.getElementById('match-error').classList.toggle('hidden', match || confirm.length === 0);

            document.getElementById('submit-btn').disabled = !validation.valid || !match;
        }

        function sendCode(e) {
            e.preventDefault();
            userEmail = document.getElementById('email').value;

            if (!Validation.isValidEmail(userEmail)) {
                Utils.showToast('Email inválido', 'error');
                return;
            }

            // Simulate sending code
            Utils.showToast('Código enviado para seu email!', 'success');

            // Mask email
            const [local, domain] = userEmail.split('@');
            const masked = local.substring(0, 2) + '***@' + domain;
            document.getElementById('masked-email').textContent = masked;

            // Show step 2
            document.getElementById('step-1').classList.add('hidden');
            document.getElementById('step-2').classList.remove('hidden');
            document.querySelector('.code-input').focus();
        }

        function verifyCode(e) {
            e.preventDefault();
            const inputs = document.querySelectorAll('.code-input');
            const code = Array.from(inputs).map(i => i.value).join('');

            if (code === mockCode) {
                Utils.showToast('Código verificado!', 'success');
                document.getElementById('step-2').classList.add('hidden');
                document.getElementById('step-3').classList.remove('hidden');
            } else {
                Utils.showToast('Código inválido', 'error');
                inputs.forEach(i => {
                    i.value = '';
                    i.classList.add('border-red-500');
                });
                inputs[0].focus();
                setTimeout(() => inputs.forEach(i => i.classList.remove('border-red-500')), 2000);
            }
        }

        function resendCode() {
            Utils.showToast('Novo código enviado!', 'success');
        }

        function resetPassword(e) {
            e.preventDefault();
            const password = document.getElementById('new-password').value;

            // In production, this would call an API
            Utils.showToast('Senha alterada com sucesso!', 'success');
            document.getElementById('step-3').classList.add('hidden');
            document.getElementById('step-4').classList.remove('hidden');
        }

        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            input.type = input.type === 'password' ? 'text' : 'password';
        }
    </script>
</body>

</html>