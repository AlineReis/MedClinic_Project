<!DOCTYPE html>
<html lang="pt-BR" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recuperar Senha - MedClinic</title>

      <link rel="icon" type="image/png" sizes="32x32" href="../assets/icons/icon-plus.png" />
  <link rel="shortcut icon" href="../assets/icons/icon-plus.png" />
<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@400;500&display=swap"
        rel="stylesheet">

    <!-- Base CSS -->
    <link rel="stylesheet" href="../css/base/reset.css">
    <link rel="stylesheet" href="../css/base/variables.css">
    <link rel="stylesheet" href="../css/base/typography.css">
    <link rel="stylesheet" href="../css/base/utilities.css">

    <link rel="stylesheet" href="../css/global.css" />
    <link rel="stylesheet" href="../css/pages/auth.css" />
</head>

<body class="auth-body">
    <div class="auth-container">
        <!-- Logo -->
        <div class="auth-header">
            <span class="material-symbols-outlined auth-logo-icon">local_hospital</span>
            <h1 class="auth-title">MedClinic</h1>
            <p class="auth-subtitle">Recuperação de Senha</p>
        </div>

        <!-- Step 1: Email -->
        <div id="step-1" class="auth-card">
            <div class="auth-header">
                <span class="material-symbols-outlined auth-logo-icon">mail</span>
                <h2 class="auth-title">Esqueceu sua senha?</h2>
                <p class="auth-subtitle">
                    Digite seu email cadastrado e enviaremos um código de verificação.
                </p>
            </div>

            <form id="email-form" class="auth-form" onsubmit="sendCode(event)">
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" id="email" class="form-input" required placeholder="seu@email.com">
                </div>

                <button type="submit" class="btn-auth-primary">
                    Enviar Código
                </button>
            </form>

            <p class="auth-footer">
                Lembrou a senha? <a href="login.html" class="auth-link">Fazer login</a>
            </p>
        </div>

        <!-- Step 2: Code Verification -->
        <div id="step-2" class="auth-card u-hidden">
            <div class="auth-header">
                <span class="material-symbols-outlined auth-logo-icon">pin</span>
                <h2 class="auth-title">Código de Verificação</h2>
                <p class="auth-subtitle">
                    Digite o código de 6 dígitos enviado para<br>
                    <strong id="masked-email"></strong>
                </p>
            </div>

            <form id="code-form" class="auth-form" onsubmit="verifyCode(event)">
                <div class="form-group">
                    <div class="code-inputs-group" id="code-inputs">
                        <input type="text" maxlength="1" class="form-input form-input-code code-input">
                        <input type="text" maxlength="1" class="form-input form-input-code code-input">
                        <input type="text" maxlength="1" class="form-input form-input-code code-input">
                        <input type="text" maxlength="1" class="form-input form-input-code code-input">
                        <input type="text" maxlength="1" class="form-input form-input-code code-input">
                        <input type="text" maxlength="1" class="form-input form-input-code code-input">
                    </div>
                </div>

                <button type="submit" class="btn-auth-primary">
                    Verificar Código
                </button>
            </form>

            <p class="auth-footer">
                Não recebeu? <button onclick="resendCode()" class="auth-link btn-link-reset">Reenviar código</button>
            </p>
        </div>

        <!-- Step 3: New Password -->
        <div id="step-3" class="auth-card u-hidden">
            <div class="auth-header">
                <span class="material-symbols-outlined auth-logo-icon">lock_reset</span>
                <h2 class="auth-title">Nova Senha</h2>
                <p class="auth-subtitle">
                    Crie uma nova senha segura para sua conta.
                </p>
            </div>

            <form id="password-form" class="auth-form" onsubmit="resetPassword(event)">
                <div class="form-group">
                    <label class="form-label">Nova Senha</label>
                    <div class="form-input-wrapper">
                        <input type="password" id="new-password" class="form-input" required
                            placeholder="Mínimo 8 caracteres">
                        <button type="button" onclick="togglePassword('new-password')" class="btn-input-icon">
                            <span class="material-symbols-outlined">visibility</span>
                        </button>
                    </div>
                    <div id="password-requirements" class="password-requirements">
                        <p id="req-length" class="req-item req-invalid">✗ Mínimo 8 caracteres</p>
                        <p id="req-upper" class="req-item req-invalid">✗ Uma letra maiúscula</p>
                        <p id="req-lower" class="req-item req-invalid">✗ Uma letra minúscula</p>
                        <p id="req-number" class="req-item req-invalid">✗ Um número</p>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Confirmar Senha</label>
                    <input type="password" id="confirm-password" class="form-input" required
                        placeholder="Digite novamente">
                    <p id="match-error" class="req-item req-invalid u-hidden"
                        style="font-size: 10px; margin-top: 0.25rem;">As senhas não coincidem</p>
                </div>

                <button type="submit" id="submit-btn" class="btn-auth-primary" disabled>
                    Redefinir Senha
                </button>
            </form>
        </div>

        <!-- Step 4: Success -->
        <div id="step-4" class="auth-card success-state-container u-hidden">
            <div class="success-icon-box">
                <span class="material-symbols-outlined success-icon">check_circle</span>
            </div>
            <h2 class="auth-title">Senha Alterada!</h2>
            <p class="auth-subtitle">
                Sua senha foi redefinida com sucesso. Você já pode fazer login com a nova senha.
            </p>
            <a href="login.html" class="btn-auth-primary">
                Ir para Login
            </a>
        </div>
    </div>

    <script src="../js/utils/validation.js"></script>
    <script src="../js/utils/utils.js"></script>
    <script>
        let userEmail = '';
        const mockCode = '123456'; // In production, this would be sent via email

        // Code input auto-focus
        document.querySelectorAll('.code-input').forEach((input, index, inputs) => {
            input.addEventListener('input', (e) => {
                if (e.target.value && index < inputs.length - 1) {
                    inputs[index + 1].focus();
                }
            });
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Backspace' && !e.target.value && index > 0) {
                    inputs[index - 1].focus();
                }
            });
        });

        // Password validation live update
        document.getElementById('new-password')?.addEventListener('input', (e) => {
            const password = e.target.value;

            updateRequirement('req-length', password.length >= 8);
            updateRequirement('req-upper', /[A-Z]/.test(password));
            updateRequirement('req-lower', /[a-z]/.test(password));
            updateRequirement('req-number', /\d/.test(password));

            checkPasswordMatch();
        });

        document.getElementById('confirm-password')?.addEventListener('input', checkPasswordMatch);

        function updateRequirement(id, valid) {
            const el = document.getElementById(id);
            el.className = 'req-item ' + (valid ? 'req-valid' : 'req-invalid');
            el.textContent = (valid ? '✓ ' : '✗ ') + el.textContent.substring(2);
        }

        function checkPasswordMatch() {
            const password = document.getElementById('new-password').value;
            const confirm = document.getElementById('confirm-password').value;
            const validation = Validation.isValidPassword(password);

            const match = password === confirm && confirm.length > 0;
            const matchError = document.getElementById('match-error');
            if (matchError) {
                matchError.style.display = (match || confirm.length === 0) ? 'none' : 'block';
            }

            const submitBtn = document.getElementById('submit-btn');
            if (submitBtn) {
                submitBtn.disabled = !validation.valid || !match;
            }
        }

        function sendCode(e) {
            e.preventDefault();
            userEmail = document.getElementById('email').value;

            if (!Validation.isValidEmail(userEmail)) {
                Utils.showToast('Email inválido', 'error');
                return;
            }

            // Simulate sending code
            Utils.showToast('Código enviado para seu email!', 'success');

            // Mask email
            const [local, domain] = userEmail.split('@');
            const masked = local.substring(0, 2) + '***@' + domain;
            const maskedEl = document.getElementById('masked-email');
            if (maskedEl) maskedEl.textContent = masked;

            // Show step 2
            document.getElementById('step-1').classList.add('u-hidden');
            document.getElementById('step-2').classList.remove('u-hidden');
            const firstInput = document.querySelector('.code-input');
            if (firstInput) firstInput.focus();
        }

        function verifyCode(e) {
            e.preventDefault();
            const inputs = document.querySelectorAll('.code-input');
            const code = Array.from(inputs).map(i => i.value).join('');

            if (code === mockCode) {
                Utils.showToast('Código verificado!', 'success');
                document.getElementById('step-2').classList.add('u-hidden');
                document.getElementById('step-3').classList.remove('u-hidden');
            } else {
                Utils.showToast('Código inválido', 'error');
                inputs.forEach(i => {
                    i.value = '';
                    i.style.borderColor = '#ef4444';
                });
                inputs[0].focus();
                setTimeout(() => inputs.forEach(i => i.style.borderColor = ''), 2000);
            }
        }

        function resendCode() {
            Utils.showToast('Novo código enviado!', 'success');
        }

        function resetPassword(e) {
            e.preventDefault();
            const password = document.getElementById('new-password').value;

            // In production, this would call an API
            Utils.showToast('Senha alterada com sucesso!', 'success');
            document.getElementById('step-3').classList.add('u-hidden');
            document.getElementById('step-4').classList.remove('u-hidden');
        }

        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            input.type = input.type === 'password' ? 'text' : 'password';
        }
    </script>
</body>

</html>